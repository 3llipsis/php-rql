box: mbrevda/php
services:
    - rethinkdb
build:
    steps:
      - script:
          name: echo php information
          code: |
            echo "php version $(php --version) running"
            echo "from location $(which php)"
      - script:
          name: install composer
          code: >
            command -v foo >/dev/null 2>&1
            || curl -sS https://getcomposer.org/installer | php -- --install-dir=/bin --filename=composer;
            composer --version 
      - script:
          name: remove stale assets
          code: >
              if [ -f composer.lock ]; then rm composer.lock; fi;
              if [ -d vendor        ]; then rm -r vendor; fi;
      - script:
          name: install composer dependencies
          code: >
            mkdir -p $WERCKER_CACHE_DIR/.composer/cache;
            composer config cache-dir $WERCKER_CACHE_DIR/.composer/cache;
            composer install --no-interaction
      - script:
          name: phplint
          code: ./vendor/bin/parallel-lint --exclude vendor .
        #- mbrevda/phpcs:
        #-     directory: src/
      - script:
          name: phpunit
          code: composer test
